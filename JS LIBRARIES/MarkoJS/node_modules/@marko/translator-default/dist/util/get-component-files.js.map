{"version":3,"sources":["../../src/util/get-component-files.js"],"names":["COMPONENT_FILES_KEY","Symbol","getComponentFiles","hub","file","meta","metadata","marko","filename","opts","fs","markoOpts","fileSystem","ext","path","extname","dirname","dirFiles","readdirSync","sort","nameNoExt","basename","isEntry","fileMatch","styleMatch","RegExp","componentMatch","splitComponentMatch","packageMatch","styleFile","packageFile","componentFile","componentBrowserFile","test","hasComponent","hasComponentBrowser"],"mappings":"gKAAA;AACA;;AAEA,MAAMA,mBAAmB,GAAGC,MAAM,EAAlC;;AAEe,SAASC,iBAAT,CAA2B,EAAEC,GAAG,EAAE,EAAEC,IAAF,EAAP,EAA3B,EAA8C;AAC3D,QAAMC,IAAI,GAAGD,IAAI,CAACE,QAAL,CAAcC,KAA3B;;AAEA,MAAIF,IAAI,CAACL,mBAAD,CAAR,EAA+B;AAC7B,WAAOK,IAAI,CAACL,mBAAD,CAAX;AACD;;AAED,QAAM,EAAEQ,QAAF,KAAeJ,IAAI,CAACK,IAA1B;AACA,QAAMC,EAAE,GAAGN,IAAI,CAACO,SAAL,CAAeC,UAA1B;AACA,QAAMC,GAAG,GAAGC,cAAKC,OAAL,CAAaP,QAAb,CAAZ;AACA,QAAMQ,OAAO,GAAGF,cAAKE,OAAL,CAAaR,QAAb,CAAhB;AACA,QAAMS,QAAQ,GAAGP,EAAE,CAACQ,WAAH,CAAeF,OAAf,EAAwBG,IAAxB,EAAjB;AACA,QAAMC,SAAS,GAAGN,cAAKO,QAAL,CAAcb,QAAd,EAAwBK,GAAxB,CAAlB;AACA,QAAMS,OAAO,GAAG,YAAYF,SAA5B;AACA,QAAMG,SAAS,GAAI,IAAG,iCAAaH,SAAb,CAAwB,MAAKE,OAAO,GAAG,GAAH,GAAS,EAAG,GAAtE;AACA,QAAME,UAAU,GAAG,IAAIC,MAAJ,CAAY,IAAGF,SAAU,eAAzB,CAAnB;AACA,QAAMG,cAAc,GAAG,IAAID,MAAJ,CAAY,IAAGF,SAAU,mBAAzB,CAAvB;AACA,QAAMI,mBAAmB,GAAG,IAAIF,MAAJ;AACzB,MAAGF,SAAU,2BADY,CAA5B;;AAGA,QAAMK,YAAY,GAAG,IAAIH,MAAJ,CAAY,IAAGF,SAAU,mBAAzB,CAArB;AACA,MAAIM,SAAJ;AACA,MAAIC,WAAJ;AACA,MAAIC,aAAJ;AACA,MAAIC,oBAAJ;;AAEA,OAAK,MAAM5B,IAAX,IAAmBa,QAAnB,EAA6B;AAC3B,QAAI,CAACY,SAAD,IAAcL,UAAU,CAACS,IAAX,CAAgB7B,IAAhB,CAAlB,EAAyC;AACvCyB,MAAAA,SAAS,GAAI,KAAIzB,IAAK,EAAtB;AACD,KAFD,MAEO,IAAI,CAAC0B,WAAD,IAAgBF,YAAY,CAACK,IAAb,CAAkB7B,IAAlB,CAApB,EAA6C;AAClD0B,MAAAA,WAAW,GAAI,KAAI1B,IAAK,EAAxB;AACD,KAFM,MAEA,IAAI,CAAC2B,aAAD,IAAkBL,cAAc,CAACO,IAAf,CAAoB7B,IAApB,CAAtB,EAAiD;AACtD2B,MAAAA,aAAa,GAAI,KAAI3B,IAAK,EAA1B;AACAC,MAAAA,IAAI,CAAC6B,YAAL,GAAoB,IAApB;AACD,KAHM,MAGA,IAAI,CAACF,oBAAD,IAAyBL,mBAAmB,CAACM,IAApB,CAAyB7B,IAAzB,CAA7B,EAA6D;AAClE4B,MAAAA,oBAAoB,GAAI,KAAI5B,IAAK,EAAjC;AACAC,MAAAA,IAAI,CAAC8B,mBAAL,GAA2B,IAA3B;AACD;AACF;;AAED,SAAQ9B,IAAI,CAACL,mBAAD,CAAJ,GAA4B;AAClC6B,IAAAA,SADkC;AAElCC,IAAAA,WAFkC;AAGlCC,IAAAA,aAHkC;AAIlCC,IAAAA,oBAJkC,EAApC;;AAMD","sourcesContent":["import path from \"path\";\nimport escapeRegExp from \"escape-string-regexp\";\n\nconst COMPONENT_FILES_KEY = Symbol();\n\nexport default function getComponentFiles({ hub: { file } }) {\n  const meta = file.metadata.marko;\n\n  if (meta[COMPONENT_FILES_KEY]) {\n    return meta[COMPONENT_FILES_KEY];\n  }\n\n  const { filename } = file.opts;\n  const fs = file.markoOpts.fileSystem;\n  const ext = path.extname(filename);\n  const dirname = path.dirname(filename);\n  const dirFiles = fs.readdirSync(dirname).sort();\n  const nameNoExt = path.basename(filename, ext);\n  const isEntry = \"index\" === nameNoExt;\n  const fileMatch = `(${escapeRegExp(nameNoExt)}\\\\.${isEntry ? \"|\" : \"\"})`;\n  const styleMatch = new RegExp(`^${fileMatch}style\\\\.\\\\w+$`);\n  const componentMatch = new RegExp(`^${fileMatch}component\\\\.\\\\w+$`);\n  const splitComponentMatch = new RegExp(\n    `^${fileMatch}component-browser\\\\.\\\\w+$`\n  );\n  const packageMatch = new RegExp(`^${fileMatch}browser\\\\.\\\\json$`);\n  let styleFile;\n  let packageFile;\n  let componentFile;\n  let componentBrowserFile;\n\n  for (const file of dirFiles) {\n    if (!styleFile && styleMatch.test(file)) {\n      styleFile = `./${file}`;\n    } else if (!packageFile && packageMatch.test(file)) {\n      packageFile = `./${file}`;\n    } else if (!componentFile && componentMatch.test(file)) {\n      componentFile = `./${file}`;\n      meta.hasComponent = true;\n    } else if (!componentBrowserFile && splitComponentMatch.test(file)) {\n      componentBrowserFile = `./${file}`;\n      meta.hasComponentBrowser = true;\n    }\n  }\n\n  return (meta[COMPONENT_FILES_KEY] = {\n    styleFile,\n    packageFile,\n    componentFile,\n    componentBrowserFile\n  });\n}\n"],"file":"get-component-files.js"}