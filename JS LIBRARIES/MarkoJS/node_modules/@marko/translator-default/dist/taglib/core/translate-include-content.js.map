{"version":3,"sources":["../../../src/taglib/core/translate-include-content.js"],"names":["enter","tag","hub","file","fs","markoOpts","fileSystem","tagName","get","node","value","tagExample","args","length","buildCodeFrameError","content","isStringLiteral","dir","path","dirname","opts","filename","fullPath","resolve","stat","statSync","isFile","Error","replaceWith","t","markoPlaceholder","stringLiteral","readFileSync","toString"],"mappings":"kJAAA;AACA;AACA;;AAEO,SAASA,KAAT,CAAeC,GAAf,EAAoB;AACzB,QAAM;AACJC,IAAAA,GAAG,EAAE,EAAEC,IAAF,EADD;AAEFF,EAAAA,GAFJ;AAGA,kCAAeA,GAAf;AACA,sCAAmBA,GAAnB;;AAEA,QAAMG,EAAE,GAAGD,IAAI,CAACE,SAAL,CAAeC,UAA1B;AACA,QAAMC,OAAO,GAAGN,GAAG,CAACO,GAAJ,CAAQ,MAAR,EAAgBC,IAAhB,CAAqBC,KAArC;AACA,QAAMC,UAAU,GAAI,IAAGJ,OAAQ,yBAA/B;AACA,QAAMK,IAAI,GAAGX,GAAG,CAACO,GAAJ,CAAQ,WAAR,CAAb;;AAEA,MAAII,IAAI,CAACC,MAAL,KAAgB,CAApB,EAAuB;AACrB,UAAMZ,GAAG,CAACa,mBAAJ;AACH,8CAAyCH,UAAW,GADjD,CAAN;;AAGD;;AAED,QAAM,CAACI,OAAD,IAAYH,IAAlB;;AAEA,MAAI,CAACG,OAAO,CAACC,eAAR,EAAL,EAAgC;AAC9B,UAAMD,OAAO,CAACD,mBAAR;AACH,uBAAkBH,UAAW,2BAD1B,CAAN;;AAGD;;AAED,QAAMM,GAAG,GAAGC,cAAKC,OAAL,CAAahB,IAAI,CAACiB,IAAL,CAAUC,QAAvB,CAAZ;AACA,QAAMC,QAAQ,GAAGJ,cAAKK,OAAL,CAAaN,GAAb,EAAkBF,OAAO,CAACN,IAAR,CAAaC,KAA/B,CAAjB;;AAEA,MAAI;AACF,UAAMc,IAAI,GAAGpB,EAAE,CAACqB,QAAH,CAAYH,QAAZ,CAAb;;AAEA,QAAI,CAACE,IAAI,CAACE,MAAL,EAAL,EAAoB;AAClB,YAAM,IAAIC,KAAJ,EAAN;AACD;AACF,GAND,CAME,MAAM;AACN,UAAMZ,OAAO,CAACD,mBAAR,CAA6B,4BAA2BP,OAAQ,IAAhE,CAAN;AACD;;AAEDN,EAAAA,GAAG,CAAC2B,WAAJ;AACEC,kBAAEC,gBAAF;AACED,kBAAEE,aAAF,CAAgB3B,EAAE,CAAC4B,YAAH,CAAgBV,QAAhB,EAA0BW,QAA1B,CAAmC,OAAnC,CAAhB,CADF;AAEE1B,EAAAA,OAAO,KAAK,cAFd,CADF;;;AAMD","sourcesContent":["import path from \"path\";\nimport { types as t } from \"@marko/compiler\";\nimport { assertNoParams, assertNoAttributes } from \"@marko/babel-utils\";\n\nexport function enter(tag) {\n  const {\n    hub: { file }\n  } = tag;\n  assertNoParams(tag);\n  assertNoAttributes(tag);\n\n  const fs = file.markoOpts.fileSystem;\n  const tagName = tag.get(\"name\").node.value;\n  const tagExample = `<${tagName}(\"./path-to-file.ext\")>`;\n  const args = tag.get(\"arguments\");\n\n  if (args.length !== 1) {\n    throw tag.buildCodeFrameError(\n      `A single path argument is required for ${tagExample}.`\n    );\n  }\n\n  const [content] = args;\n\n  if (!content.isStringLiteral()) {\n    throw content.buildCodeFrameError(\n      `The argument to ${tagExample} must be a static string.`\n    );\n  }\n\n  const dir = path.dirname(file.opts.filename);\n  const fullPath = path.resolve(dir, content.node.value);\n\n  try {\n    const stat = fs.statSync(fullPath);\n\n    if (!stat.isFile()) {\n      throw new Error();\n    }\n  } catch {\n    throw content.buildCodeFrameError(`Unable to find file for <${tagName}>.`);\n  }\n\n  tag.replaceWith(\n    t.markoPlaceholder(\n      t.stringLiteral(fs.readFileSync(fullPath).toString(\"utf-8\")),\n      tagName === \"include-text\"\n    )\n  );\n}\n"],"file":"translate-include-content.js"}