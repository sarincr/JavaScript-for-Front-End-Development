{"version":3,"sources":["../../../src/taglib/loader/Tag.js"],"names":["ok","require","path","hasOwnProperty","Object","prototype","Tag","constructor","filePath","dir","dirname","migrators","attributes","transformers","patternAttributes","addAttribute","attr","pattern","push","name","dynamicAttribute","targetProperty","undefined","toString","taglibId","forEachAttribute","callback","thisObj","attrName","call","getAttribute","attribute","i","len","length","patternAttribute","test","hasAttribute","addNestedTag","nestedTag","nestedTags","isNestedTag","hasNestedTags","toJSON","setTaglib","taglib","id","taglibPath","module","exports"],"mappings":"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","sourcesContent":["\"use strict\";\nvar ok = require(\"assert\").ok;\nvar path = require(\"path\");\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\n\nclass Tag {\n  constructor(filePath) {\n    this.filePath = filePath;\n    if (filePath) {\n      this.dir = path.dirname(filePath);\n    }\n\n    this.migrators = [];\n    this.attributes = {};\n    this.transformers = [];\n    this.patternAttributes = [];\n  }\n\n  addAttribute(attr) {\n    attr.filePath = this.filePath;\n\n    if (attr.pattern) {\n      this.patternAttributes.push(attr);\n    } else {\n      if (attr.name === \"*\") {\n        attr.dynamicAttribute = true;\n\n        if (attr.targetProperty === undefined || attr.targetProperty === \"\") {\n          attr.targetProperty = null;\n        }\n      }\n\n      this.attributes[attr.name] = attr;\n    }\n  }\n  toString() {\n    return \"[Tag: <\" + this.name + \"@\" + this.taglibId + \">]\";\n  }\n  forEachAttribute(callback, thisObj) {\n    for (var attrName in this.attributes) {\n      if (hasOwnProperty.call(this.attributes, attrName)) {\n        callback.call(thisObj, this.attributes[attrName]);\n      }\n    }\n  }\n  getAttribute(attrName) {\n    var attributes = this.attributes;\n\n    // try by exact match first\n    var attribute = attributes[attrName] || attributes[\"*\"];\n\n    if (attribute === undefined && this.patternAttributes) {\n      // try searching by pattern\n      for (var i = 0, len = this.patternAttributes.length; i < len; i++) {\n        var patternAttribute = this.patternAttributes[i];\n        if (patternAttribute.pattern.test(attrName)) {\n          attribute = patternAttribute;\n          break;\n        }\n      }\n    }\n\n    return attribute;\n  }\n\n  hasAttribute(attrName) {\n    return hasOwnProperty.call(this.attributes, attrName);\n  }\n\n  addNestedTag(nestedTag) {\n    ok(nestedTag.name, '\"nestedTag.name\" is required');\n\n    if (!this.nestedTags) {\n      this.nestedTags = {};\n    }\n\n    nestedTag.isNestedTag = true;\n\n    if (!nestedTag.targetProperty) {\n      nestedTag.targetProperty = nestedTag.name;\n    }\n\n    this.nestedTags[nestedTag.name] = nestedTag;\n  }\n\n  hasNestedTags() {\n    return this.nestedTags != null;\n  }\n\n  toJSON() {\n    return this;\n  }\n\n  setTaglib(taglib) {\n    this.taglibId = taglib ? taglib.id : null;\n    this.taglibPath = taglib ? taglib.path : null;\n  }\n}\n\nmodule.exports = Tag;\n"],"file":"Tag.js"}