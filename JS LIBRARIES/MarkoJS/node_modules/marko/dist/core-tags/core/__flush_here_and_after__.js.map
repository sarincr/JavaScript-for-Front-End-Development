{"version":3,"sources":["../../../src/core-tags/core/__flush_here_and_after__.js"],"names":["BufferedWriter","require","module","exports","__flushHereAndAfter__","input","out","flushed","asyncOut","beginAsync","last","nextWriter","writer","on","detachedOut","createOut","sync","renderBody","_content","toString","next","end","onLast"],"mappings":"aAAA,MAAMA,cAAc,GAAGC,OAAO,CAAC,mCAAD,CAA9B;;AAEAC,MAAM,CAACC,OAAP,GAAiB,SAASC,qBAAT,CAA+BC,KAA/B,EAAsCC,GAAtC,EAA2C;AAC1D,MAAIC,OAAO,GAAG,KAAd;AACA,QAAMC,QAAQ,GAAGF,GAAG,CAACG,UAAJ,CAAe,EAAEC,IAAI,EAAE,IAAR,EAAf,CAAjB;AACA,QAAMC,UAAU,GAAGL,GAAG,CAACM,MAAvB;;AAEAN,EAAAA,GAAG,CAACO,EAAJ,OAAsB,CAAAD,MAAM,KAAI;AAC9B,QAAIA,MAAM,YAAYZ,cAAtB,EAAsC;AACpC,UAAIO,OAAJ,EAAa;AACX,cAAMO,WAAW,GAAGR,GAAG,CAACS,SAAJ,EAApB;AACAD,QAAAA,WAAW,CAACE,IAAZ;AACAX,QAAAA,KAAK,CAACY,UAAN,CAAiBH,WAAjB;AACAF,QAAAA,MAAM,CAACM,QAAP,GAAkBJ,WAAW,CAACK,QAAZ,KAAyBP,MAAM,CAACM,QAAlD;AACD,OALD,MAKO,IAAIN,MAAM,CAACQ,IAAP,KAAgBT,UAApB,EAAgC;AACrCH,QAAAA,QAAQ,CAACQ,IAAT;AACAX,QAAAA,KAAK,CAACY,UAAN,CAAiBT,QAAjB;AACAA,QAAAA,QAAQ,CAACa,GAAT;AACAd,QAAAA,OAAO,GAAG,IAAV;AACD;AACF;AACF,GAdD;;AAgBAD,EAAAA,GAAG,CAACgB,MAAJ,CAAW,MAAM;AACf,QAAI,CAACf,OAAL,EAAc;AACZC,MAAAA,QAAQ,CAACQ,IAAT;AACAX,MAAAA,KAAK,CAACY,UAAN,CAAiBT,QAAjB;AACAA,MAAAA,QAAQ,CAACa,GAAT;AACAd,MAAAA,OAAO,GAAG,IAAV;AACD;AACF,GAPD;AAQD,CA7BD","sourcesContent":["const BufferedWriter = require(\"../../runtime/html/BufferedWriter\");\n\nmodule.exports = function __flushHereAndAfter__(input, out) {\n  let flushed = false;\n  const asyncOut = out.beginAsync({ last: true });\n  const nextWriter = out.writer;\n\n  out.on(\"___toString\", writer => {\n    if (writer instanceof BufferedWriter) {\n      if (flushed) {\n        const detachedOut = out.createOut();\n        detachedOut.sync();\n        input.renderBody(detachedOut);\n        writer._content = detachedOut.toString() + writer._content;\n      } else if (writer.next === nextWriter) {\n        asyncOut.sync();\n        input.renderBody(asyncOut);\n        asyncOut.end();\n        flushed = true;\n      }\n    }\n  });\n\n  out.onLast(() => {\n    if (!flushed) {\n      asyncOut.sync();\n      input.renderBody(asyncOut);\n      asyncOut.end();\n      flushed = true;\n    }\n  });\n};\n"],"file":"__flush_here_and_after__.js"}