{"version":3,"sources":["../../../../src/runtime/html/create-readable/index.js"],"names":["stream","require","OutgoingMessageProto","OutgoingMessage","prototype","String","flush","indexOf","Readable","constructor","template","data","write","push","end","_read","globalData","$global","out","createOut","undefined","render","module","exports"],"mappings":"aAAA,IAAIA,MAAM,GAAGC,OAAO,CAAC,QAAD,CAApB;;AAEA,IAAIC,oBAAoB,GAAGD,OAAO,CAAC,MAAD,CAAP,CAAgBE,eAAhB,CAAgCC,SAA3D;AACA,IAAIC,MAAM,CAACH,oBAAoB,CAACI,KAAtB,CAAN,CAAmCC,OAAnC,CAA2C,YAA3C,MAA6D,CAAC,CAAlE,EAAqE;AACnE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAOL,oBAAoB,CAACI,KAA5B;AACD;;AAED,MAAME,QAAN,SAAuBR,MAAM,CAACQ,QAA9B,CAAuC;AACrCC,EAAAA,WAAW,CAACC,QAAD,EAAWC,IAAX,EAAiB;AAC1B;AACA,eAAmBD,QAAnB;AACA,eAAeC,IAAf;AACA,eAAmB,KAAnB;AACD;;AAEDC,EAAAA,KAAK,CAACD,IAAD,EAAO;AACV,QAAIA,IAAI,IAAI,IAAZ,EAAkB;AAChB,WAAKE,IAAL,CAAUF,IAAV;AACD;AACF;;AAEDG,EAAAA,GAAG,GAAG;AACJ,SAAKD,IAAL,CAAU,IAAV;AACD;;AAEDE,EAAAA,KAAK,GAAG;AACN,QAAI,QAAJ,EAAsB;AACpB;AACD;;AAED,eAAmB,IAAnB;AACA,QAAIL,QAAQ,GAAG,QAAf;AACA,QAAIC,IAAI,GAAG,QAAX;AACA,QAAIK,UAAU,GAAGL,IAAI,IAAIA,IAAI,CAACM,OAA9B;AACA,QAAIC,GAAG,GAAG,SAAiBC,SAAjB;AACRH,IAAAA,UADQ;AAER,QAFQ;AAGRI,IAAAA,SAHQ;AAIRV,IAAAA,QAAQ,IAJA,CAAV;;AAMAA,IAAAA,QAAQ,CAACW,MAAT,CAAgBV,IAAhB,EAAsBO,GAAtB;AACAA,IAAAA,GAAG,CAACJ,GAAJ;AACD,GAnCoC;;;AAsCvCQ,MAAM,CAACC,OAAP,GAAiB,UAAUZ,IAAV,EAAgB;AAC/B,SAAO,IAAIH,QAAJ,CAAa,IAAb,EAAmBG,IAAnB,CAAP;AACD,CAFD","sourcesContent":["var stream = require(\"stream\");\n\nvar OutgoingMessageProto = require(\"http\").OutgoingMessage.prototype;\nif (String(OutgoingMessageProto.flush).indexOf(\"deprecated\") !== -1) {\n  // Yes, we are monkey-patching http. This method should never have been added and it was introduced on\n  // the iojs fork. It was quickly deprecated and I'm 99% sure no one is actually using it.\n  // See:\n  // - https://github.com/marko-js/async-writer/issues/3\n  // - https://github.com/nodejs/node/issues/2920\n  //\n  // This method causes problems since marko looks for the flush method and calls it found.\n  // The `res.flush()` method is introduced by the [compression](https://www.npmjs.com/package/compression)\n  // middleware, but, otherwise, it should typically not exist.\n  delete OutgoingMessageProto.flush;\n}\n\nclass Readable extends stream.Readable {\n  constructor(template, data) {\n    super();\n    this.___template = template;\n    this.___data = data;\n    this.___rendered = false;\n  }\n\n  write(data) {\n    if (data != null) {\n      this.push(data);\n    }\n  }\n\n  end() {\n    this.push(null);\n  }\n\n  _read() {\n    if (this.___rendered) {\n      return;\n    }\n\n    this.___rendered = true;\n    var template = this.___template;\n    var data = this.___data;\n    var globalData = data && data.$global;\n    var out = this.___template.createOut(\n      globalData,\n      this,\n      undefined,\n      template.___shouldBuffer\n    );\n    template.render(data, out);\n    out.end();\n  }\n}\n\nmodule.exports = function (data) {\n  return new Readable(this, data);\n};\n"],"file":"index.js"}