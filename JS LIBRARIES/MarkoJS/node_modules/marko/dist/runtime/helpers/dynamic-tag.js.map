{"version":3,"sources":["../../../src/runtime/helpers/dynamic-tag.js"],"names":["changeCase","require","ComponentsContext","getComponentsContext","ComponentDef","w10NOOP","NOOP","RENDER_BODY_TO_JSON","FLAG_WILL_RERENDER_IN_BROWSER","IS_SERVER","window","module","exports","dynamicTag","out","tag","getAttrs","renderBody","args","props","componentDef","key","customEvents","default","attrs","component","addEvents","attrsToCamelCase","renderer","_","render","c","isFn","flags","willRerender","isW10NOOP","preserve","bf","componentsContext","parentComponentDef","globalContext","id","toJSON","apply","concat","ef","error","result","len","length","event","i","d"],"mappings":"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","sourcesContent":["\"use strict\";\n\nvar complain = \"MARKO_DEBUG\" && require(\"complain\");\nvar changeCase = require(\"./_change-case\");\nvar ComponentsContext = require(\"../components/ComponentsContext\");\nvar getComponentsContext = ComponentsContext.___getComponentsContext;\nvar ComponentDef = require(\"../components/ComponentDef\");\nvar w10NOOP = require(\"warp10/constants\").NOOP;\nvar RENDER_BODY_TO_JSON = function () {\n  return w10NOOP;\n};\n\nvar FLAG_WILL_RERENDER_IN_BROWSER = 1;\n// var FLAG_HAS_RENDER_BODY = 2;\nvar IS_SERVER = typeof window === \"undefined\";\n\n/**\n * Helper to render a dynamic tag\n */\nmodule.exports = function dynamicTag(\n  out,\n  tag,\n  getAttrs,\n  renderBody,\n  args,\n  props,\n  componentDef,\n  key,\n  customEvents\n) {\n  if (tag) {\n    if (tag.default) {\n      tag = tag.default;\n    }\n\n    var attrs = getAttrs && getAttrs();\n    var component = componentDef && componentDef.___component;\n    if (typeof tag === \"string\") {\n      if (renderBody) {\n        out.___beginElementDynamic(\n          tag,\n          attrs,\n          key,\n          componentDef,\n          addEvents(componentDef, customEvents, props)\n        );\n        renderBody(out);\n        out.___endElement();\n      } else {\n        out.___elementDynamic(\n          tag,\n          attrs,\n          key,\n          componentDef,\n          addEvents(componentDef, customEvents, props)\n        );\n      }\n    } else {\n      if (attrs == null) {\n        attrs = { renderBody: renderBody };\n      } else if (typeof attrs === \"object\") {\n        attrs = attrsToCamelCase(attrs);\n        if (renderBody) {\n          attrs.renderBody = renderBody;\n        }\n      }\n\n      var renderer =\n        tag._ ||\n        tag.render ||\n        (tag.renderer && tag.renderer.renderer) ||\n        tag.renderer;\n\n      // eslint-disable-next-line no-constant-condition\n      if (\"MARKO_DEBUG\") {\n        if (tag.renderer && tag.renderer.renderer === renderer) {\n          complain(\n            \"An object with a 'renderer' was passed to the dynamic tag, but renderer was another template.\"\n          );\n        }\n      }\n\n      if (renderer) {\n        out.c(componentDef, key, customEvents);\n        renderer(attrs, out);\n        out.___assignedComponentDef = null;\n      } else {\n        var render = (tag && tag.renderBody) || tag;\n        var isFn = typeof render === \"function\";\n\n        // eslint-disable-next-line no-constant-condition\n        if (\"MARKO_DEBUG\") {\n          if (render.safeHTML || render.toHTML) {\n            throw new Error(\n              \"Using `<include(x)/>` or the `<${dynamic}/>` tags with a `{ safeHTML: ... }` object is no longer supported. Use the unescaped text placeholder syntax instead.\"\n            );\n          }\n        }\n        if (isFn) {\n          var flags = componentDef ? componentDef.___flags : 0;\n          var willRerender = flags & FLAG_WILL_RERENDER_IN_BROWSER;\n          var isW10NOOP = render === w10NOOP;\n          var preserve = IS_SERVER ? willRerender : isW10NOOP;\n          out.bf(key, component, preserve);\n          if (!isW10NOOP && isFn) {\n            var componentsContext = getComponentsContext(out);\n            var parentComponentDef = componentsContext.___componentDef;\n            var globalContext = componentsContext.___globalContext;\n            componentsContext.___componentDef = new ComponentDef(\n              component,\n              parentComponentDef.id + \"-\" + parentComponentDef.___nextKey(key),\n              globalContext\n            );\n            render.toJSON = RENDER_BODY_TO_JSON;\n\n            if (args) {\n              render.apply(null, [out].concat(args, attrs));\n            } else {\n              render(out, attrs);\n            }\n\n            componentsContext.___componentDef = parentComponentDef;\n          }\n          out.ef();\n        } else {\n          out.error(\"Invalid dynamic tag value\");\n        }\n      }\n    }\n  } else if (renderBody) {\n    out.bf(\n      key,\n      component,\n      IS_SERVER &&\n        componentDef &&\n        componentDef.___flags & FLAG_WILL_RERENDER_IN_BROWSER\n    );\n    renderBody(out);\n    out.ef();\n  }\n};\n\nfunction attrsToCamelCase(attrs) {\n  var result = {};\n\n  for (var key in attrs) {\n    result[changeCase.___dashToCamelCase(key)] = attrs[key];\n  }\n\n  return result;\n}\n\nfunction addEvents(componentDef, customEvents, props) {\n  var len = customEvents ? customEvents.length : 0;\n\n  if (len === 0) {\n    return props;\n  }\n\n  var result = props || {};\n  var event;\n\n  for (var i = len; i--; ) {\n    event = customEvents[i];\n    result[\"on\" + event[0]] = componentDef.d(\n      event[0],\n      event[1],\n      event[2],\n      event[3]\n    );\n  }\n\n  return result;\n}\n"],"file":"dynamic-tag.js"}