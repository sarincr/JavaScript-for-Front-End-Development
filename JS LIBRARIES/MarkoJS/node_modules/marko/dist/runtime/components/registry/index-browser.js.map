{"version":3,"sources":["../../../../src/runtime/components/registry/index-browser.js"],"names":["queueMicrotask","require","defineComponent","initComponents","registered","loaded","componentTypes","pendingDefs","register","type","def","pendingForType","forEach","args","addPendingDef","meta","doc","runtimeId","push","isRegistered","Boolean","load","typeName","target","Error","getComponentClass","ComponentClass","Component","renderer","prototype","createComponent","id","exports","r"],"mappings":"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","sourcesContent":["var complain = \"MARKO_DEBUG\" && require(\"complain\");\nvar queueMicrotask = require(\"../../queueMicrotask\");\nvar defineComponent = require(\"../defineComponent\");\nvar initComponents = require(\"../init-components\");\nrequire(\"../entry\");\n\nvar registered = {};\nvar loaded = {};\nvar componentTypes = {};\nvar pendingDefs;\n\nfunction register(type, def) {\n  var pendingForType;\n  if (pendingDefs) {\n    pendingForType = pendingDefs[type];\n  }\n  registered[type] = def;\n  delete loaded[type];\n  delete componentTypes[type];\n\n  if (pendingForType) {\n    delete pendingDefs[type];\n    queueMicrotask(function () {\n      pendingForType.forEach(function (args) {\n        initComponents.___tryHydrateComponent(\n          args[0],\n          args[1],\n          args[2],\n          args[3]\n        )();\n      });\n    });\n  }\n\n  return type;\n}\n\nfunction addPendingDef(def, type, meta, doc, runtimeId) {\n  if (!pendingDefs) {\n    pendingDefs = {};\n\n    // eslint-disable-next-line no-constant-condition\n    if (\"MARKO_DEBUG\") {\n      doc.addEventListener(\"load\", function () {\n        var pendingComponentIds = Object.keys(pendingDefs);\n        if (pendingComponentIds.length) {\n          complain(\n            \"Marko templates were never loaded for: \" + pendingComponentIds\n          );\n        }\n      });\n    }\n  }\n  (pendingDefs[type] = pendingDefs[type] || []).push([\n    def,\n    meta,\n    doc,\n    runtimeId\n  ]);\n}\n\nfunction isRegistered(type) {\n  return Boolean(registered[type]);\n}\n\nfunction load(typeName) {\n  var target = loaded[typeName];\n  if (!target) {\n    target = registered[typeName];\n\n    if (target) {\n      target = target();\n    }\n\n    if (!target) {\n      throw Error(\"Component not found: \" + typeName);\n    }\n\n    loaded[typeName] = target;\n  }\n\n  return target;\n}\n\nfunction getComponentClass(typeName) {\n  var ComponentClass = componentTypes[typeName];\n\n  if (ComponentClass) {\n    return ComponentClass;\n  }\n\n  ComponentClass = load(typeName);\n\n  ComponentClass = ComponentClass.Component || ComponentClass;\n\n  if (!ComponentClass.___isComponent) {\n    ComponentClass = defineComponent(ComponentClass, ComponentClass.renderer);\n  }\n\n  // Make the component \"type\" accessible on each component instance\n  ComponentClass.prototype.___type = typeName;\n\n  // eslint-disable-next-line no-constant-condition\n  if (\"MARKO_DEBUG\") {\n    var classNameMatch =\n      /\\/([^/]+?)(?:\\/index|\\/template|)(?:\\.marko|\\.component(?:-browser)?|)$/.exec(\n        typeName\n      );\n    var className = classNameMatch ? classNameMatch[1] : \"AnonymousComponent\";\n    className = className.replace(/-(.)/g, function (g) {\n      return g[1].toUpperCase();\n    });\n    className = className\n      .replace(/\\$\\d+\\.\\d+\\.\\d+$/, \"\")\n      .replace(/^[^a-z$_]/i, \"_$&\")\n      .replace(/[^0-9a-z$_]+/gi, \"_\");\n    className = className[0].toUpperCase() + className.slice(1);\n    // eslint-disable-next-line no-unused-vars\n    try {\n      var OldComponentClass = ComponentClass;\n      eval(\n        \"ComponentClass = function \" +\n          className +\n          \"(id, doc) { OldComponentClass.call(this, id, doc); }\"\n      );\n      ComponentClass.prototype = OldComponentClass.prototype;\n    } catch (e) {\n      /** ignore error */\n    }\n  }\n\n  componentTypes[typeName] = ComponentClass;\n\n  return ComponentClass;\n}\n\nfunction createComponent(typeName, id) {\n  var ComponentClass = getComponentClass(typeName);\n  return new ComponentClass(id);\n}\n\nexports.r = register;\nexports.___getComponentClass = getComponentClass;\nexports.___createComponent = createComponent;\nexports.___isRegistered = isRegistered;\nexports.___addPendingDef = addPendingDef;\n"],"file":"index-browser.js"}