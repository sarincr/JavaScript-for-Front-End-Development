{"version":3,"sources":["../../../src/runtime/components/attach-detach.js"],"names":["eventDelegation","require","delegateEvent","getEventFromEl","handleNodeAttach","node","componentsContext","nodeType","eventName","target","out","data","attachTargets","on","i","length","push","handleNodeDetach","allowDetach","preventDefault","detach","parentNode","removeChild"],"mappings":"aAAA,IAAIA,eAAe,GAAGC,OAAO,CAAC,oBAAD,CAA7B;AACA,IAAIC,aAAa,GAAGF,eAAe,IAAnC;AACA,IAAIG,cAAc,GAAGH,eAAe,IAApC;;AAEA;AACA;AACA;;AAEA,SAASI,gBAAT,CAA0BC,IAA1B,EAAgCC,iBAAhC,EAAmD;AACjD,MAAID,IAAI,CAACE,QAAL,KAAkB,CAAtB,EAAyB;AACvB,QAAIC,SAAS,GAAG,UAAhB;AACA,QAAIC,MAAM,GAAGN,cAAc,CAACE,IAAD,EAAOG,SAAP,CAA3B;AACA,QAAIC,MAAJ,EAAY;AACV,UAAIC,GAAG,GAAGJ,iBAAiB,GAA3B;AACA,UAAIK,IAAI,GAAGD,GAAG,CAACC,IAAf;;AAEA,UAAIC,aAAa,GAAGD,IAAI,IAAxB;AACA,UAAI,CAACC,aAAL,EAAoB;AAClBA,QAAAA,aAAa,GAAGD,IAAI,IAAJ,GAAwB,EAAxC;AACAD,QAAAA,GAAG,CAACG,EAAJ,QAAmC,YAAY;AAC7C,eAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGF,aAAa,CAACG,MAAlC,EAA0CD,CAAC,IAAI,CAA/C,EAAkD;AAChD,gBAAIT,IAAI,GAAGO,aAAa,CAACE,CAAD,CAAxB;AACA,gBAAIL,MAAM,GAAGG,aAAa,CAACE,CAAC,GAAG,CAAL,CAA1B;AACAZ,YAAAA,aAAa,CAACG,IAAD,EAAOG,SAAP,EAAkBC,MAAlB,EAA0B,EAA1B,CAAb;AACD;AACF,SAND;AAOD;;AAEDG,MAAAA,aAAa,CAACI,IAAd,CAAmBX,IAAnB;AACAO,MAAAA,aAAa,CAACI,IAAd,CAAmBP,MAAnB;AACD;AACF;AACF;;AAED,SAASQ,gBAAT,CAA0BZ,IAA1B,EAAgC;AAC9B,MAAIA,IAAI,CAACE,QAAL,KAAkB,CAAtB,EAAyB;AACvB,QAAIC,SAAS,GAAG,UAAhB;AACA,QAAIC,MAAM,GAAGN,cAAc,CAACE,IAAD,EAAOG,SAAP,CAA3B;AACA,QAAIC,MAAJ,EAAY;AACV,UAAIS,WAAJ;;AAEAhB,MAAAA,aAAa,CAACG,IAAD,EAAOG,SAAP,EAAkBC,MAAlB,EAA0B;AACrCU,QAAAA,cAAc,EAAE,YAAY;AAC1BD,UAAAA,WAAW,GAAG,KAAd;AACD,SAHoC;AAIrCE,QAAAA,MAAM,EAAE,YAAY;AAClB,cAAIC,UAAU,GAAGhB,IAAI,CAACgB,UAAtB;AACA,cAAIA,UAAJ,EAAgB;AACdA,YAAAA,UAAU,CAACC,WAAX,CAAuBjB,IAAvB;AACD;AACF,SAToC,EAA1B,CAAb;;;AAYA,aAAOa,WAAP;AACD;AACF;AACF;;AAEDlB,eAAe,IAAf,GAAsCI,gBAAtC;AACAJ,eAAe,IAAf,GAAsCiB,gBAAtC","sourcesContent":["var eventDelegation = require(\"./event-delegation\");\nvar delegateEvent = eventDelegation.___delegateEvent;\nvar getEventFromEl = eventDelegation.___getEventFromEl;\n\n// var componentsUtil = require('./util');\n// var destroyNodeRecursive = componentsUtil.___destroyNodeRecursive;\n// var destroyComponentForNode = componentsUtil.___destroyComponentForNode;\n\nfunction handleNodeAttach(node, componentsContext) {\n  if (node.nodeType === 1) {\n    var eventName = \"onattach\";\n    var target = getEventFromEl(node, eventName);\n    if (target) {\n      var out = componentsContext.___out;\n      var data = out.data;\n\n      var attachTargets = data.___attachTargets;\n      if (!attachTargets) {\n        attachTargets = data.___attachTargets = [];\n        out.on(\"___componentsInitialized\", function () {\n          for (var i = 0; i < attachTargets.length; i += 2) {\n            var node = attachTargets[i];\n            var target = attachTargets[i + 1];\n            delegateEvent(node, eventName, target, {});\n          }\n        });\n      }\n\n      attachTargets.push(node);\n      attachTargets.push(target);\n    }\n  }\n}\n\nfunction handleNodeDetach(node) {\n  if (node.nodeType === 1) {\n    var eventName = \"ondetach\";\n    var target = getEventFromEl(node, eventName);\n    if (target) {\n      var allowDetach;\n\n      delegateEvent(node, eventName, target, {\n        preventDefault: function () {\n          allowDetach = false;\n        },\n        detach: function () {\n          var parentNode = node.parentNode;\n          if (parentNode) {\n            parentNode.removeChild(node);\n          }\n        }\n      });\n\n      return allowDetach;\n    }\n  }\n}\n\neventDelegation.___handleNodeAttach = handleNodeAttach;\neventDelegation.___handleNodeDetach = handleNodeDetach;\n"],"file":"attach-detach.js"}