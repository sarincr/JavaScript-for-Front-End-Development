{"version":3,"sources":["../../../src/runtime/components/ComponentDef.js"],"names":["w10Noop","require","NOOP","componentUtil","attachBubblingEvent","addDelegatedEventHandler","extend","KeySequence","EMPTY_OBJECT","FLAG_WILL_RERENDER_IN_BROWSER","FLAG_HAS_RENDER_BODY","ComponentDef","component","componentId","componentsContext","id","undefined","prototype","key","elId","nestedId","String","indexOf","substring","d","eventName","handlerMethodName","isOnce","extraArgs","nk","o","types","global","registry","typeName","input","extra","state","s","componentProps","w","flags","f","renderBody","onCreate","onInput","undefinedPropNames","u","forEach","undefinedPropName","b","scope","p","customEvents","e","module","exports"],"mappings":"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","sourcesContent":["\"use strict\";\nvar complain = \"MARKO_DEBUG\" && require(\"complain\");\nvar w10Noop = require(\"warp10/constants\").NOOP;\nvar componentUtil = require(\"./util\");\nvar attachBubblingEvent = componentUtil.___attachBubblingEvent;\nvar addDelegatedEventHandler =\n  require(\"./event-delegation\").___addDelegatedEventHandler;\nvar extend = require(\"raptor-util/extend\");\nvar KeySequence = require(\"./KeySequence\");\nvar EMPTY_OBJECT = {};\n\nvar FLAG_WILL_RERENDER_IN_BROWSER = 1;\nvar FLAG_HAS_RENDER_BODY = 2;\n\n/**\n * A ComponentDef is used to hold the metadata collected at runtime for\n * a single component and this information is used to instantiate the component\n * later (after the rendered HTML has been added to the DOM)\n */\nfunction ComponentDef(component, componentId, componentsContext) {\n  this.___componentsContext = componentsContext; // The AsyncWriter that this component is associated with\n  this.___component = component;\n  this.id = componentId;\n\n  this.___domEvents = undefined; // An array of DOM events that need to be added (in sets of three)\n\n  this.___isExisting = false;\n\n  this.___renderBoundary = false;\n  this.___flags = 0;\n\n  this.___nextIdIndex = 0; // The unique integer to use for the next scoped ID\n  this.___keySequence = null;\n}\n\nComponentDef.prototype = {\n  ___nextKey: function (key) {\n    return (\n      this.___keySequence || (this.___keySequence = new KeySequence())\n    ).___nextKey(key);\n  },\n\n  /**\n   * This helper method generates a unique and fully qualified DOM element ID\n   * that is unique within the scope of the current component.\n   */\n  elId: function (nestedId) {\n    var id = this.id;\n\n    if (nestedId == null) {\n      return id;\n    } else {\n      if (typeof nestedId !== \"string\") {\n        // eslint-disable-next-line no-constant-condition\n        if (\"MARKO_DEBUG\") {\n          complain(\"Using non strings as keys is deprecated.\");\n        }\n\n        nestedId = String(nestedId);\n      }\n\n      if (nestedId.indexOf(\"#\") === 0) {\n        id = \"#\" + id;\n        nestedId = nestedId.substring(1);\n      }\n\n      return id + \"-\" + nestedId;\n    }\n  },\n  /**\n   * Returns the next auto generated unique ID for a nested DOM element or nested DOM component\n   */\n  ___nextComponentId: function () {\n    return this.id + \"-c\" + this.___nextIdIndex++;\n  },\n\n  d: function (eventName, handlerMethodName, isOnce, extraArgs) {\n    addDelegatedEventHandler(eventName);\n    return attachBubblingEvent(this, handlerMethodName, isOnce, extraArgs);\n  },\n\n  get ___type() {\n    return this.___component.___type;\n  }\n};\n\nComponentDef.prototype.nk = ComponentDef.prototype.___nextKey;\n\nComponentDef.___deserialize = function (o, types, global, registry) {\n  var id = o[0];\n  var typeName = types[o[1]];\n  var input = o[2] || null;\n  var extra = o[3] || EMPTY_OBJECT;\n\n  var state = extra.s;\n  var componentProps = extra.w;\n  var flags = extra.f;\n  var component = registry.___createComponent(typeName, id);\n\n  // Prevent newly created component from being queued for update since we area\n  // just building it from the server info\n  component.___updateQueued = true;\n\n  if (flags & FLAG_HAS_RENDER_BODY) {\n    (input || (input = {})).renderBody = w10Noop;\n  }\n\n  if (flags & FLAG_WILL_RERENDER_IN_BROWSER) {\n    if (component.onCreate) {\n      component.onCreate(input, { global: global });\n    }\n    if (component.onInput) {\n      input = component.onInput(input, { global: global }) || input;\n    }\n  } else {\n    if (state) {\n      var undefinedPropNames = extra.u;\n      if (undefinedPropNames) {\n        undefinedPropNames.forEach(function (undefinedPropName) {\n          state[undefinedPropName] = undefined;\n        });\n      }\n      // We go through the setter here so that we convert the state object\n      // to an instance of `State`\n      component.state = state;\n    }\n\n    if (componentProps) {\n      extend(component, componentProps);\n    }\n  }\n\n  component.___input = input;\n\n  if (extra.b) {\n    component.___bubblingDomEvents = extra.b;\n  }\n\n  var scope = extra.p;\n  var customEvents = extra.e;\n  if (customEvents) {\n    component.___setCustomEvents(customEvents, scope);\n  }\n\n  component.___global = global;\n\n  return {\n    id: id,\n    ___component: component,\n    ___domEvents: extra.d,\n    ___flags: extra.f || 0\n  };\n};\n\nmodule.exports = ComponentDef;\n"],"file":"ComponentDef.js"}