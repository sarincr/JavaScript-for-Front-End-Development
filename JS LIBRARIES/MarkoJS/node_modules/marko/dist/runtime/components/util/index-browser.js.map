{"version":3,"sources":["../../../../src/runtime/components/util/index-browser.js"],"names":["domData","require","componentsByDOMNode","keysByDOMNode","vElementsByDOMNode","vPropsByDOMNode","markoUID","window","$MUID","i","runtimeId","componentLookup","defaultDocument","document","EMPTY_OBJECT","getComponentForEl","el","doc","node","getElementById","component","vElement","fragment","endNode","startNode","get","previousSibling","parentNode","destroyComponentForNode","componentToDestroy","id","destroyNodeRecursive","nodeType","key","test","curChild","firstChild","nextSibling","nextComponentId","nextComponentIdProvider","attachBubblingEvent","componentDef","handlerMethodName","isOnce","extraArgs","componentId","getMarkoPropsFromEl","virtualProps","getAttribute","set","JSON","parse","normalizeComponentKey","parentId","replace","addComponentRootToKeyedElements","keyedElements","rootNode","repeatedElementsForKey","exports"],"mappings":"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","sourcesContent":["var domData = require(\"../dom-data\");\nvar componentsByDOMNode = domData.___componentByDOMNode;\nvar keysByDOMNode = domData.___keyByDOMNode;\nvar vElementsByDOMNode = domData.___vElementByDOMNode;\nvar vPropsByDOMNode = domData.___vPropsByDOMNode;\nvar markoUID = window.$MUID || (window.$MUID = { i: 0 });\nvar runtimeId = markoUID.i++;\n\nvar componentLookup = {};\n\nvar defaultDocument = document;\nvar EMPTY_OBJECT = {};\n\nfunction getComponentForEl(el, doc) {\n  var node =\n    typeof el == \"string\" ? (doc || defaultDocument).getElementById(el) : el;\n  var component;\n  var vElement;\n\n  while (node) {\n    if (node.fragment) {\n      if (node.fragment.endNode === node) {\n        node = node.fragment.startNode;\n      } else {\n        node = node.fragment;\n        component = componentsByDOMNode.get(node);\n      }\n    } else if ((vElement = vElementsByDOMNode.get(node))) {\n      component = vElement.___ownerComponent;\n    }\n\n    if (component) {\n      return component;\n    }\n\n    node = node.previousSibling || node.parentNode;\n  }\n}\n\nfunction destroyComponentForNode(node) {\n  var componentToDestroy = componentsByDOMNode.get(node.fragment || node);\n  if (componentToDestroy) {\n    componentToDestroy.___destroyShallow();\n    delete componentLookup[componentToDestroy.id];\n  }\n}\nfunction destroyNodeRecursive(node, component) {\n  destroyComponentForNode(node);\n  if (node.nodeType === 1 || node.nodeType === 12) {\n    var key;\n\n    if (component && (key = keysByDOMNode.get(node))) {\n      if (node === component.___keyedElements[key]) {\n        if (componentsByDOMNode.get(node) && /\\[\\]$/.test(key)) {\n          delete component.___keyedElements[key][\n            componentsByDOMNode.get(node).id\n          ];\n        } else {\n          delete component.___keyedElements[key];\n        }\n      }\n    }\n\n    var curChild = node.firstChild;\n    while (curChild && curChild !== node.endNode) {\n      destroyNodeRecursive(curChild, component);\n      curChild = curChild.nextSibling;\n    }\n  }\n}\n\nfunction nextComponentId() {\n  // Each component will get an ID that is unique across all loaded\n  // marko runtimes. This allows multiple instances of marko to be\n  // loaded in the same window and they should all place nice\n  // together\n  return \"c\" + markoUID.i++;\n}\n\nfunction nextComponentIdProvider() {\n  return nextComponentId;\n}\n\nfunction attachBubblingEvent(\n  componentDef,\n  handlerMethodName,\n  isOnce,\n  extraArgs\n) {\n  if (handlerMethodName) {\n    var componentId = componentDef.id;\n    if (extraArgs) {\n      return [handlerMethodName, componentId, isOnce, extraArgs];\n    } else {\n      return [handlerMethodName, componentId, isOnce];\n    }\n  }\n}\n\nfunction getMarkoPropsFromEl(el) {\n  var vElement = vElementsByDOMNode.get(el);\n  var virtualProps;\n\n  if (vElement) {\n    virtualProps = vElement.___properties;\n  } else {\n    virtualProps = vPropsByDOMNode.get(el);\n    if (!virtualProps) {\n      virtualProps = el.getAttribute(\"data-marko\");\n      vPropsByDOMNode.set(\n        el,\n        (virtualProps = virtualProps ? JSON.parse(virtualProps) : EMPTY_OBJECT)\n      );\n    }\n  }\n\n  return virtualProps;\n}\n\nfunction normalizeComponentKey(key, parentId) {\n  if (key[0] === \"#\") {\n    key = key.replace(\"#\" + parentId + \"-\", \"\");\n  }\n  return key;\n}\n\nfunction addComponentRootToKeyedElements(\n  keyedElements,\n  key,\n  rootNode,\n  componentId\n) {\n  if (/\\[\\]$/.test(key)) {\n    var repeatedElementsForKey = (keyedElements[key] =\n      keyedElements[key] || {});\n    repeatedElementsForKey[componentId] = rootNode;\n  } else {\n    keyedElements[key] = rootNode;\n  }\n}\n\n// eslint-disable-next-line no-constant-condition\nif (\"MARKO_DEBUG\") {\n  var warnNodeRemoved = function (event) {\n    var fragment = event.target.fragment;\n    if (fragment) {\n      var baseError = new Error(\n        \"Fragment boundary marker removed.  This will cause an error when the fragment is updated.\"\n      );\n      fragment.___markersRemovedError = function (message) {\n        var error = new Error(message + \" Boundary markers missing.\");\n\n        baseError.stack = baseError.stack.replace(/.*warnNodeRemoved.*\\n/, \"\");\n\n        // eslint-disable-next-line no-console\n        console.warn(baseError);\n        return error;\n      };\n    }\n  };\n  exports.___startDOMManipulationWarning = function () {\n    document.addEventListener(\"DOMNodeRemoved\", warnNodeRemoved);\n  };\n  exports.___stopDOMManipulationWarning = function () {\n    document.removeEventListener(\"DOMNodeRemoved\", warnNodeRemoved);\n  };\n}\n\nexports.___runtimeId = runtimeId;\nexports.___componentLookup = componentLookup;\nexports.___getComponentForEl = getComponentForEl;\nexports.___destroyComponentForNode = destroyComponentForNode;\nexports.___destroyNodeRecursive = destroyNodeRecursive;\nexports.___nextComponentIdProvider = nextComponentIdProvider;\nexports.___attachBubblingEvent = attachBubblingEvent;\nexports.___getMarkoPropsFromEl = getMarkoPropsFromEl;\nexports.___addComponentRootToKeyedElements = addComponentRootToKeyedElements;\nexports.___normalizeComponentKey = normalizeComponentKey;\n"],"file":"index-browser.js"}