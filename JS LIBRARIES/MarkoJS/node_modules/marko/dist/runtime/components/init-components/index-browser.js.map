{"version":3,"sources":["../../../../src/runtime/components/init-components/index-browser.js"],"names":["warp10Finalize","require","eventDelegation","win","window","defaultDocument","document","createFragmentNode","componentsUtil","componentLookup","addComponentRootToKeyedElements","ComponentDef","registry","domData","keyedElementsByComponentId","componentsByDOMNode","serverComponentRootNodes","serverRenderedMeta","DEFAULT_RUNTIME_ID","FLAG_WILL_RERENDER_IN_BROWSER","deferredDefs","indexServerComponentBoundaries","node","runtimeId","stack","componentId","ownerId","ownerComponent","keyedElements","nextSibling","runtimeLength","length","firstChild","nodeType","commentValue","nodeValue","slice","firstChar","push","endNode","startNode","pop","rootNode","parentNode","substring","parts","split","key","removeChild","markoKey","getAttribute","markoProps","separatorIndex","indexOf","Object","keys","forEach","invokeComponentEventHandler","component","targetMethodName","args","method","Error","apply","addEventListenerHelper","el","eventType","isOnce","listener","eventListener","event","removeEventListener","addEventListener","remove","addDOMEventListeners","extraArgs","handles","removeListener","concat","initComponent","componentDef","doc","isExisting","domEvents","eventListenerHandles","domEventArgs","eventEl","initClientRendered","componentDefs","len","i","trackComponent","initServerRendered","renderedComponents","type","globalKey","fakeArray","r","renderedComponent","isFromSerializedGlobals","prefix","p","meta","isLast","l","g","t","w","map","typeName","tryHydrateComponent","reverse","tryInvoke","rawDef","mount","hydrateComponentAndGetMount","undefined","id","renderResult","set","afterInsert","fn","exports"],"mappings":"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","sourcesContent":["\"use strict\";\nvar complain = \"MARKO_DEBUG\" && require(\"complain\");\nvar warp10Finalize = require(\"warp10/finalize\");\nvar eventDelegation = require(\"../event-delegation\");\nvar win = window;\nvar defaultDocument = document;\nvar createFragmentNode =\n  require(\"../../vdom/morphdom/fragment\").___createFragmentNode;\nvar componentsUtil = require(\"../util\");\nvar componentLookup = componentsUtil.___componentLookup;\nvar addComponentRootToKeyedElements =\n  componentsUtil.___addComponentRootToKeyedElements;\nvar ComponentDef = require(\"../ComponentDef\");\nvar registry = require(\"../registry\");\nvar domData = require(\"../dom-data\");\nvar keyedElementsByComponentId = domData.___ssrKeyedElementsByComponentId;\nvar componentsByDOMNode = domData.___componentByDOMNode;\nvar serverComponentRootNodes = {};\nvar serverRenderedMeta = {};\n\nvar DEFAULT_RUNTIME_ID = \"M\";\nvar FLAG_WILL_RERENDER_IN_BROWSER = 1;\n// var FLAG_HAS_RENDER_BODY = 2;\n\nvar deferredDefs;\n\nfunction indexServerComponentBoundaries(node, runtimeId, stack) {\n  var componentId;\n  var ownerId;\n  var ownerComponent;\n  var keyedElements;\n  var nextSibling;\n  var runtimeLength = runtimeId.length;\n  stack = stack || [];\n\n  node = node.firstChild;\n  while (node) {\n    nextSibling = node.nextSibling;\n    if (node.nodeType === 8) {\n      // Comment node\n      var commentValue = node.nodeValue;\n      if (commentValue.slice(0, runtimeLength) === runtimeId) {\n        var firstChar = commentValue[runtimeLength];\n\n        if (firstChar === \"^\" || firstChar === \"#\") {\n          stack.push(node);\n        } else if (firstChar === \"/\") {\n          var endNode = node;\n          var startNode = stack.pop();\n          var rootNode;\n\n          if (startNode.parentNode === endNode.parentNode) {\n            rootNode = createFragmentNode(startNode.nextSibling, endNode);\n          } else {\n            rootNode = createFragmentNode(\n              endNode.parentNode.firstChild,\n              endNode\n            );\n          }\n\n          componentId = startNode.nodeValue.substring(runtimeLength + 1);\n          firstChar = startNode.nodeValue[runtimeLength];\n\n          if (firstChar === \"^\") {\n            var parts = componentId.split(/ /g);\n            var key = parts[2];\n            ownerId = parts[1];\n            componentId = parts[0];\n            if ((ownerComponent = componentLookup[ownerId])) {\n              keyedElements = ownerComponent.___keyedElements;\n            } else {\n              keyedElements =\n                keyedElementsByComponentId[ownerId] ||\n                (keyedElementsByComponentId[ownerId] = {});\n            }\n            addComponentRootToKeyedElements(\n              keyedElements,\n              key,\n              rootNode,\n              componentId\n            );\n          }\n\n          serverComponentRootNodes[componentId] = rootNode;\n\n          startNode.parentNode.removeChild(startNode);\n          endNode.parentNode.removeChild(endNode);\n        }\n      }\n    } else if (node.nodeType === 1) {\n      // HTML element node\n      var markoKey = node.getAttribute(\"data-marko-key\");\n      var markoProps = componentsUtil.___getMarkoPropsFromEl(node);\n      if (markoKey) {\n        var separatorIndex = markoKey.indexOf(\" \");\n        ownerId = markoKey.substring(separatorIndex + 1);\n        markoKey = markoKey.substring(0, separatorIndex);\n        if ((ownerComponent = componentLookup[ownerId])) {\n          keyedElements = ownerComponent.___keyedElements;\n        } else {\n          keyedElements =\n            keyedElementsByComponentId[ownerId] ||\n            (keyedElementsByComponentId[ownerId] = {});\n        }\n        keyedElements[markoKey] = node;\n      }\n      if (markoProps) {\n        Object.keys(markoProps).forEach(function (key) {\n          if (key.slice(0, 2) === \"on\") {\n            eventDelegation.___addDelegatedEventHandler(key.slice(2));\n          }\n        });\n      }\n      indexServerComponentBoundaries(node, runtimeId, stack);\n    }\n\n    node = nextSibling;\n  }\n}\n\nfunction invokeComponentEventHandler(component, targetMethodName, args) {\n  var method = component[targetMethodName];\n  if (!method) {\n    throw Error(\"Method not found: \" + targetMethodName);\n  }\n\n  method.apply(component, args);\n}\n\nfunction addEventListenerHelper(el, eventType, isOnce, listener) {\n  var eventListener = listener;\n  if (isOnce) {\n    eventListener = function (event) {\n      listener(event);\n      el.removeEventListener(eventType, eventListener);\n    };\n  }\n\n  el.addEventListener(eventType, eventListener, false);\n\n  return function remove() {\n    el.removeEventListener(eventType, eventListener);\n  };\n}\n\nfunction addDOMEventListeners(\n  component,\n  el,\n  eventType,\n  targetMethodName,\n  isOnce,\n  extraArgs,\n  handles\n) {\n  var removeListener = addEventListenerHelper(\n    el,\n    eventType,\n    isOnce,\n    function (event) {\n      var args = [event, el];\n      if (extraArgs) {\n        args = extraArgs.concat(args);\n      }\n\n      invokeComponentEventHandler(component, targetMethodName, args);\n    }\n  );\n  handles.push(removeListener);\n}\n\nfunction initComponent(componentDef, doc) {\n  var component = componentDef.___component;\n\n  component.___reset();\n  component.___document = doc;\n\n  var isExisting = componentDef.___isExisting;\n\n  if (isExisting) {\n    component.___removeDOMEventListeners();\n  }\n\n  var domEvents = componentDef.___domEvents;\n  if (domEvents) {\n    var eventListenerHandles = [];\n\n    domEvents.forEach(function (domEventArgs) {\n      // The event mapping is for a direct DOM event (not a custom event and not for bubblign dom events)\n\n      var eventType = domEventArgs[0];\n      var targetMethodName = domEventArgs[1];\n      var eventEl = component.___keyedElements[domEventArgs[2]];\n      var isOnce = domEventArgs[3];\n      var extraArgs = domEventArgs[4];\n\n      addDOMEventListeners(\n        component,\n        eventEl,\n        eventType,\n        targetMethodName,\n        isOnce,\n        extraArgs,\n        eventListenerHandles\n      );\n    });\n\n    if (eventListenerHandles.length) {\n      component.___domEventListenerHandles = eventListenerHandles;\n    }\n  }\n\n  if (component.___mounted) {\n    component.___emitUpdate();\n  } else {\n    component.___mounted = true;\n    component.___emitMount();\n  }\n}\n\n/**\n * This method is used to initialized components associated with UI components\n * rendered in the browser. While rendering UI components a \"components context\"\n * is added to the rendering context to keep up with which components are rendered.\n * When ready, the components can then be initialized by walking the component tree\n * in the components context (nested components are initialized before ancestor components).\n * @param  {Array<marko-components/lib/ComponentDef>} componentDefs An array of ComponentDef instances\n */\nfunction initClientRendered(componentDefs, doc) {\n  // Ensure that event handlers to handle delegating events are\n  // always attached before initializing any components\n  eventDelegation.___init(doc);\n\n  doc = doc || defaultDocument;\n  var len = componentDefs.length;\n  var componentDef;\n  var i;\n\n  for (i = len; i--; ) {\n    componentDef = componentDefs[i];\n    trackComponent(componentDef);\n  }\n\n  for (i = len; i--; ) {\n    componentDef = componentDefs[i];\n    initComponent(componentDef, doc);\n  }\n}\n\n/**\n * This method initializes all components that were rendered on the server by iterating over all\n * of the component IDs.\n */\nfunction initServerRendered(renderedComponents, doc) {\n  var type = typeof renderedComponents;\n  var globalKey = \"$\";\n  var runtimeId;\n\n  if (type !== \"object\") {\n    if (type === \"string\") {\n      runtimeId = renderedComponents;\n      globalKey += runtimeId + \"_C\";\n    } else {\n      globalKey += (runtimeId = DEFAULT_RUNTIME_ID) + \"C\";\n    }\n\n    renderedComponents = win[globalKey];\n\n    // eslint-disable-next-line no-constant-condition\n    if (\"MARKO_DEBUG\") {\n      if (\n        renderedComponents &&\n        renderedComponents.i !== undefined &&\n        renderedComponents.i !== componentsUtil.___runtimeId\n      ) {\n        console.warn(\n          \"Multiple instances of Marko have attached to the same runtime id. This could mean that more than one copy of Marko is loaded on the page, or that the script containing Marko has executed more than once.\"\n        );\n      }\n    }\n\n    var fakeArray = (win[globalKey] = {\n      r: runtimeId,\n      concat: initServerRendered\n    });\n\n    // eslint-disable-next-line no-constant-condition\n    if (\"MARKO_DEBUG\") {\n      fakeArray.i = componentsUtil.___runtimeId;\n    }\n\n    if (renderedComponents && renderedComponents.forEach) {\n      renderedComponents.forEach(function (renderedComponent) {\n        fakeArray.concat(renderedComponent);\n      });\n    }\n\n    return fakeArray;\n  }\n\n  var isFromSerializedGlobals = this.concat === initServerRendered;\n  renderedComponents = warp10Finalize(renderedComponents);\n\n  if (isFromSerializedGlobals) {\n    runtimeId = this.r;\n    doc = defaultDocument;\n  } else {\n    runtimeId = renderedComponents.r || DEFAULT_RUNTIME_ID;\n    doc = doc || defaultDocument;\n\n    // eslint-disable-next-line no-constant-condition\n    if (\"MARKO_DEBUG\") {\n      complain(\n        \"Passing serialized data to `require('marko/components).init` is deprecated. Instead set '$global.runtimeId' and provide the 'runtimeId' option to your Marko bundler plugin.\"\n      );\n    }\n  }\n\n  // eslint-disable-next-line no-constant-condition\n  if (\"MARKO_DEBUG\") {\n    if (doc !== defaultDocument) {\n      complain(\n        \"Passing a document other than the current document to `require('marko/components).init` is deprecated.\"\n      );\n    }\n  }\n\n  var prefix = renderedComponents.p || \"\";\n  var meta = serverRenderedMeta[prefix];\n  var isLast = renderedComponents.l;\n\n  if (meta) {\n    if (isLast) {\n      delete serverRenderedMeta[prefix];\n    }\n  } else {\n    meta = {};\n\n    if (!isLast) {\n      serverRenderedMeta[prefix] = meta;\n    }\n  }\n\n  // Ensure that event handlers to handle delegating events are\n  // always attached before initializing any components\n  indexServerComponentBoundaries(doc, runtimeId);\n  eventDelegation.___init(doc);\n\n  if (renderedComponents.g) {\n    meta.___globals = renderedComponents.g;\n  }\n\n  if (renderedComponents.t) {\n    meta.___types = meta.___types\n      ? meta.___types.concat(renderedComponents.t)\n      : renderedComponents.t;\n  }\n\n  // hydrate components top down (leaf nodes last)\n  // and return an array of functions to mount these components\n  (renderedComponents.w || [])\n    .map(function (componentDef) {\n      var typeName = meta.___types[componentDef[1]];\n\n      return registry.___isRegistered(typeName)\n        ? tryHydrateComponent(componentDef, meta, doc, runtimeId)\n        : registry.___addPendingDef(\n            componentDef,\n            typeName,\n            meta,\n            doc,\n            runtimeId\n          );\n    })\n    .reverse()\n    .forEach(tryInvoke);\n\n  return this;\n}\n\nfunction tryHydrateComponent(rawDef, meta, doc, runtimeId) {\n  var componentDef = ComponentDef.___deserialize(\n    rawDef,\n    meta.___types,\n    meta.___globals,\n    registry\n  );\n  var mount = hydrateComponentAndGetMount(componentDef, doc);\n\n  if (!mount) {\n    // hydrateComponentAndGetMount will return false if there is not rootNode\n    // for the component.  If this is the case, we'll wait until the\n    // DOM has fully loaded to attempt to init the component again.\n    if (deferredDefs) {\n      deferredDefs.push(componentDef);\n    } else {\n      deferredDefs = [componentDef];\n      doc.addEventListener(\"DOMContentLoaded\", function () {\n        indexServerComponentBoundaries(doc, runtimeId);\n        deferredDefs\n          .map(function (componentDef) {\n            return hydrateComponentAndGetMount(componentDef, doc);\n          })\n          .reverse()\n          .forEach(tryInvoke);\n        deferredDefs = undefined;\n      });\n    }\n  }\n\n  return mount;\n}\n\nfunction hydrateComponentAndGetMount(componentDef, doc) {\n  var componentId = componentDef.id;\n  var component = componentDef.___component;\n  var rootNode = serverComponentRootNodes[componentId];\n  var renderResult;\n\n  if (rootNode) {\n    delete serverComponentRootNodes[componentId];\n\n    component.___rootNode = rootNode;\n    componentsByDOMNode.set(rootNode, component);\n\n    if (componentDef.___flags & FLAG_WILL_RERENDER_IN_BROWSER) {\n      component.___document = doc;\n      renderResult = component.___rerender(component.___input, true);\n      trackComponent(componentDef);\n      return function mount() {\n        renderResult.afterInsert(doc);\n      };\n    } else {\n      trackComponent(componentDef);\n    }\n\n    return function mount() {\n      initComponent(componentDef, doc);\n    };\n  }\n}\n\nfunction trackComponent(componentDef) {\n  var component = componentDef.___component;\n  if (component) {\n    componentLookup[component.id] = component;\n  }\n}\n\nfunction tryInvoke(fn) {\n  if (fn) fn();\n}\n\nexports.___initClientRendered = initClientRendered;\nexports.___initServerRendered = initServerRendered;\nexports.___tryHydrateComponent = tryHydrateComponent;\n"],"file":"index-browser.js"}