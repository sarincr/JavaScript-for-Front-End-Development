{"version":3,"sources":["../../../src/runtime/vdom/AsyncVDOMBuilder.js"],"names":["EventEmitter","require","vdom","VElement","VDocumentFragment","VText","VComponent","VFragment","virtualizeHTML","RenderResult","defaultDocument","morphdom","attrsHelper","EVENT_UPDATE","EVENT_FINISH","State","tree","AsyncVDOMBuilder","globalData","parentNode","parentOut","state","data","global","undefined","proto","prototype","bc","component","key","ownerComponent","vComponent","child","childCount","pushToStack","push","element","tagName","attrs","flags","props","componentDef","n","node","clone","text","type","toHTML","h","toString","html","vdomNode","document","beginElement","bf","preserve","fragment","ef","endElement","stack","pop","length","end","remaining","emit","lastArray","_last","i","next","lastCallback","error","e","beginAsync","options","Error","last","documentFragment","asyncOut","out","createOut","flush","events","listenerCount","on","event","callback","onLast","once","arg","arguments","apply","removeListener","sync","isSync","doc","vdomTree","docFragment","firstChild","nextSibling","nodeType","container","ownerDocument","createElement","appendChild","cloneNode","innerHTML","outerHTML","then","fn","fnErr","promise","Promise","resolve","reject","result","catch","isVDOM","c","customEvents","be","ee","t","w","write","module","exports"],"mappings":"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","sourcesContent":["var EventEmitter = require(\"events-light\");\nvar vdom = require(\"./vdom\");\nvar VElement = vdom.___VElement;\nvar VDocumentFragment = vdom.___VDocumentFragment;\nvar VText = vdom.___VText;\nvar VComponent = vdom.___VComponent;\nvar VFragment = vdom.___VFragment;\nvar virtualizeHTML = vdom.___virtualizeHTML;\nvar RenderResult = require(\"../RenderResult\");\nvar defaultDocument = vdom.___defaultDocument;\nvar morphdom = require(\"./morphdom\");\nvar attrsHelper = require(\"./helpers/attrs\");\n\nvar EVENT_UPDATE = \"update\";\nvar EVENT_FINISH = \"finish\";\n\nfunction State(tree) {\n  this.___events = new EventEmitter();\n  this.___tree = tree;\n  this.___finished = false;\n}\n\nfunction AsyncVDOMBuilder(globalData, parentNode, parentOut) {\n  if (!parentNode) {\n    parentNode = new VDocumentFragment();\n  }\n\n  var state;\n\n  if (parentOut) {\n    state = parentOut.___state;\n  } else {\n    state = new State(parentNode);\n  }\n\n  this.___remaining = 1;\n  this.___lastCount = 0;\n  this.___last = null;\n  this.___parentOut = parentOut;\n\n  this.data = {};\n  this.___state = state;\n  this.___parent = parentNode;\n  this.global = globalData || {};\n  this.___stack = [parentNode];\n  this.___sync = false;\n  this.___vnode = undefined;\n  this.___components = null;\n\n  this.___assignedComponentDef = null;\n  this.___assignedKey = null;\n  this.___assignedCustomEvents = null;\n}\n\nvar proto = (AsyncVDOMBuilder.prototype = {\n  ___isOut: true,\n  ___document: defaultDocument,\n\n  bc: function (component, key, ownerComponent) {\n    var vComponent = new VComponent(component, key, ownerComponent);\n    return this.___beginNode(vComponent, 0, true);\n  },\n\n  ___preserveComponent: function (component, key, ownerComponent) {\n    var vComponent = new VComponent(component, key, ownerComponent, true);\n    this.___beginNode(vComponent, 0);\n  },\n\n  ___beginNode: function (child, childCount, pushToStack) {\n    this.___parent.___appendChild(child);\n    if (pushToStack === true) {\n      this.___stack.push(child);\n      this.___parent = child;\n    }\n    return childCount === 0 ? this : child;\n  },\n\n  element: function (tagName, attrs, key, component, childCount, flags, props) {\n    var element = new VElement(\n      tagName,\n      attrs,\n      key,\n      component,\n      childCount,\n      flags,\n      props\n    );\n    return this.___beginNode(element, childCount);\n  },\n\n  ___elementDynamic: function (tagName, attrs, key, componentDef, props) {\n    return this.element(\n      tagName,\n      attrsHelper(attrs),\n      key,\n      componentDef.___component,\n      0,\n      0,\n      props\n    );\n  },\n\n  n: function (node, component) {\n    // NOTE: We do a shallow clone since we assume the node is being reused\n    //       and a node can only have one parent node.\n    var clone = node.___cloneNode();\n    this.node(clone);\n    clone.___ownerComponent = component;\n\n    return this;\n  },\n\n  node: function (node) {\n    this.___parent.___appendChild(node);\n    return this;\n  },\n\n  text: function (text, ownerComponent) {\n    var type = typeof text;\n\n    if (type != \"string\") {\n      if (text == null) {\n        return;\n      } else if (type === \"object\") {\n        if (text.toHTML) {\n          return this.h(text.toHTML(), ownerComponent);\n        }\n      }\n\n      text = text.toString();\n    }\n\n    this.___parent.___appendChild(new VText(text, ownerComponent));\n    return this;\n  },\n\n  html: function (html, ownerComponent) {\n    if (html != null) {\n      var vdomNode = virtualizeHTML(\n        html,\n        this.___document || document,\n        ownerComponent\n      );\n      this.node(vdomNode);\n    }\n\n    return this;\n  },\n\n  beginElement: function (\n    tagName,\n    attrs,\n    key,\n    component,\n    childCount,\n    flags,\n    props\n  ) {\n    var element = new VElement(\n      tagName,\n      attrs,\n      key,\n      component,\n      childCount,\n      flags,\n      props\n    );\n    this.___beginNode(element, childCount, true);\n    return this;\n  },\n\n  ___beginElementDynamic: function (tagName, attrs, key, componentDef, props) {\n    return this.beginElement(\n      tagName,\n      attrsHelper(attrs),\n      key,\n      componentDef.___component,\n      0,\n      0,\n      props\n    );\n  },\n\n  bf: function (key, component, preserve) {\n    var fragment = new VFragment(key, component, preserve);\n    this.___beginNode(fragment, null, true);\n    return this;\n  },\n\n  ef: function () {\n    this.endElement();\n  },\n\n  endElement: function () {\n    var stack = this.___stack;\n    stack.pop();\n    this.___parent = stack[stack.length - 1];\n  },\n\n  end: function () {\n    this.___parent = undefined;\n\n    var remaining = --this.___remaining;\n    var parentOut = this.___parentOut;\n\n    if (remaining === 0) {\n      if (parentOut) {\n        parentOut.___handleChildDone();\n      } else {\n        this.___doFinish();\n      }\n    } else if (remaining - this.___lastCount === 0) {\n      this.___emitLast();\n    }\n\n    return this;\n  },\n\n  ___handleChildDone: function () {\n    var remaining = --this.___remaining;\n\n    if (remaining === 0) {\n      var parentOut = this.___parentOut;\n      if (parentOut) {\n        parentOut.___handleChildDone();\n      } else {\n        this.___doFinish();\n      }\n    } else if (remaining - this.___lastCount === 0) {\n      this.___emitLast();\n    }\n  },\n\n  ___doFinish: function () {\n    var state = this.___state;\n    state.___finished = true;\n    state.___events.emit(EVENT_FINISH, this.___getResult());\n  },\n\n  ___emitLast: function () {\n    var lastArray = this._last;\n\n    var i = 0;\n\n    function next() {\n      if (i === lastArray.length) {\n        return;\n      }\n      var lastCallback = lastArray[i++];\n      lastCallback(next);\n\n      if (!lastCallback.length) {\n        next();\n      }\n    }\n\n    next();\n  },\n\n  error: function (e) {\n    try {\n      this.emit(\"error\", e);\n    } finally {\n      // If there is no listener for the error event then it will\n      // throw a new Error here. In order to ensure that the async fragment\n      // is still properly ended we need to put the end() in a `finally`\n      // block\n      this.end();\n    }\n\n    return this;\n  },\n\n  beginAsync: function (options) {\n    if (this.___sync) {\n      throw Error(\n        \"Tried to render async while in sync mode. Note: Client side await is not currently supported in re-renders (Issue: #942).\"\n      );\n    }\n\n    var state = this.___state;\n\n    if (options) {\n      if (options.last) {\n        this.___lastCount++;\n      }\n    }\n\n    this.___remaining++;\n\n    var documentFragment = this.___parent.___appendDocumentFragment();\n    var asyncOut = new AsyncVDOMBuilder(this.global, documentFragment, this);\n\n    state.___events.emit(\"beginAsync\", {\n      out: asyncOut,\n      parentOut: this\n    });\n\n    return asyncOut;\n  },\n\n  createOut: function () {\n    return new AsyncVDOMBuilder(this.global);\n  },\n\n  flush: function () {\n    var events = this.___state.___events;\n\n    if (events.listenerCount(EVENT_UPDATE)) {\n      events.emit(EVENT_UPDATE, new RenderResult(this));\n    }\n  },\n\n  ___getOutput: function () {\n    return this.___state.___tree;\n  },\n\n  ___getResult: function () {\n    return this.___result || (this.___result = new RenderResult(this));\n  },\n\n  on: function (event, callback) {\n    var state = this.___state;\n\n    if (event === EVENT_FINISH && state.___finished) {\n      callback(this.___getResult());\n    } else if (event === \"last\") {\n      this.onLast(callback);\n    } else {\n      state.___events.on(event, callback);\n    }\n\n    return this;\n  },\n\n  once: function (event, callback) {\n    var state = this.___state;\n\n    if (event === EVENT_FINISH && state.___finished) {\n      callback(this.___getResult());\n    } else if (event === \"last\") {\n      this.onLast(callback);\n    } else {\n      state.___events.once(event, callback);\n    }\n\n    return this;\n  },\n\n  emit: function (type, arg) {\n    var events = this.___state.___events;\n    switch (arguments.length) {\n      case 1:\n        events.emit(type);\n        break;\n      case 2:\n        events.emit(type, arg);\n        break;\n      default:\n        events.emit.apply(events, arguments);\n        break;\n    }\n    return this;\n  },\n\n  removeListener: function () {\n    var events = this.___state.___events;\n    events.removeListener.apply(events, arguments);\n    return this;\n  },\n\n  sync: function () {\n    this.___sync = true;\n  },\n\n  isSync: function () {\n    return this.___sync;\n  },\n\n  onLast: function (callback) {\n    var lastArray = this._last;\n\n    if (lastArray === undefined) {\n      this._last = [callback];\n    } else {\n      lastArray.push(callback);\n    }\n\n    return this;\n  },\n\n  ___getNode: function (doc) {\n    var node = this.___vnode;\n    if (!node) {\n      var vdomTree = this.___getOutput();\n      // Create the root document fragment node\n      doc = doc || this.___document || document;\n      this.___vnode = node = vdomTree.___actualize(doc, null);\n      morphdom(node, vdomTree, doc, this.___components);\n    }\n    return node;\n  },\n\n  toString: function (doc) {\n    var docFragment = this.___getNode(doc);\n    var html = \"\";\n\n    var child = docFragment.firstChild;\n    while (child) {\n      var nextSibling = child.nextSibling;\n      if (child.nodeType != 1) {\n        var container = docFragment.ownerDocument.createElement(\"div\");\n        container.appendChild(child.cloneNode());\n        html += container.innerHTML;\n      } else {\n        html += child.outerHTML;\n      }\n\n      child = nextSibling;\n    }\n\n    return html;\n  },\n\n  then: function (fn, fnErr) {\n    var out = this;\n    var promise = new Promise(function (resolve, reject) {\n      out.on(\"error\", reject).on(EVENT_FINISH, function (result) {\n        resolve(result);\n      });\n    });\n\n    return Promise.resolve(promise).then(fn, fnErr);\n  },\n\n  catch: function (fnErr) {\n    return this.then(undefined, fnErr);\n  },\n\n  isVDOM: true,\n\n  c: function (componentDef, key, customEvents) {\n    this.___assignedComponentDef = componentDef;\n    this.___assignedKey = key;\n    this.___assignedCustomEvents = customEvents;\n  }\n});\n\nproto.e = proto.element;\nproto.be = proto.beginElement;\nproto.ee = proto.___endElement = proto.endElement;\nproto.t = proto.text;\nproto.h = proto.w = proto.write = proto.html;\n\nmodule.exports = AsyncVDOMBuilder;\n"],"file":"AsyncVDOMBuilder.js"}