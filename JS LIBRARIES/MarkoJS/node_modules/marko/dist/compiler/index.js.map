{"version":3,"sources":["../../src/compiler/index.js"],"names":["compiler","require","extend","globalConfig","ok","fs","taglib","defaults","defaultOptionsExportDefinition","get","enumerable","configurable","Object","defineProperties","exports","defaultOptions","config","configure","newConfig","resultCompat","code","meta","map","options","sourceOnly","_compile","src","filename","userConfig","callback","compile","then","result","error","compileSync","compileForBrowser","output","compileFile","readFile","encoding","err","templateSrc","readFileSync","compileFileForBrowser","taglibLookup","lookup","taglibLoader","loader","taglibFinder","finder","buildTaglibLookup","buildLookup","clearCaches","_clearDefaults","clearCache","registerTaglib","filePath","registerFromFile","isVDOMSupported"],"mappings":"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","sourcesContent":["\"use strict\";\n\nvar complain = \"MARKO_DEBUG\" && require(\"complain\");\nvar compiler = require(\"@marko/compiler\");\nvar extend = require(\"raptor-util/extend\");\nvar globalConfig = require(\"./config\");\nvar ok = require(\"assert\").ok;\nvar fs = require(\"fs\");\nvar taglib = require(\"../taglib\");\nvar defaults = extend({}, globalConfig);\n\n// eslint-disable-next-line no-constant-condition\nif (\"MARKO_DEBUG\") {\n  complain(\n    \"Using `marko/compiler` has been deprecated, please upgrade to the `@marko/compiler` module.\"\n  );\n}\n\nvar defaultOptionsExportDefinition = {\n  get: function () {\n    return globalConfig;\n  },\n  enumerable: true,\n  configurable: false\n};\n\nObject.defineProperties(exports, {\n  defaultOptions: defaultOptionsExportDefinition,\n  config: defaultOptionsExportDefinition\n});\n\nfunction configure(newConfig) {\n  if (!newConfig) {\n    newConfig = {};\n  }\n\n  globalConfig = extend({}, defaults);\n  extend(globalConfig, newConfig);\n\n  compiler.configure(newConfig);\n}\n\nfunction resultCompat({ code, meta, map }, options = {}) {\n  if (options.sourceOnly !== false) {\n    return code;\n  } else {\n    return { code, meta, map };\n  }\n}\n\nfunction _compile(src, filename, userConfig, callback) {\n  ok(filename, '\"filename\" argument is required');\n  ok(typeof filename === \"string\", '\"filename\" argument should be a string');\n  var options = {};\n\n  extend(options, globalConfig);\n\n  if (userConfig) {\n    extend(options, userConfig);\n  }\n\n  if (callback) {\n    compiler.compile(src, filename, options).then(\n      result => callback(null, resultCompat(result, options)),\n      error => callback(error)\n    );\n  } else {\n    return resultCompat(compiler.compileSync(src, filename, options), options);\n  }\n}\n\nfunction compile(src, filename, options, callback) {\n  if (typeof options === \"function\") {\n    callback = options;\n    options = null;\n  }\n\n  options = options || {};\n  options.sourceOnly = options.sourceOnly !== false;\n\n  return _compile(src, filename, options, callback);\n}\n\nfunction compileForBrowser(src, filename, options, callback) {\n  if (typeof options === \"function\") {\n    callback = options;\n    options = null;\n  }\n\n  options = extend(\n    {\n      output: \"dom\",\n      meta: false,\n      sourceOnly: false\n    },\n    options\n  );\n\n  return compile(src, filename, options, callback);\n}\n\nfunction compileFile(filename, options, callback) {\n  if (typeof options === \"function\") {\n    callback = options;\n    options = null;\n  }\n\n  options = options || {};\n  options.sourceOnly = options.sourceOnly !== false;\n\n  if (callback) {\n    fs.readFile(filename, { encoding: \"utf8\" }, function (err, templateSrc) {\n      if (err) {\n        return callback(err);\n      }\n\n      _compile(templateSrc, filename, options, callback);\n    });\n  } else {\n    let templateSrc = fs.readFileSync(filename, { encoding: \"utf8\" });\n    return _compile(templateSrc, filename, options, callback);\n  }\n}\n\nfunction compileFileForBrowser(filename, options, callback) {\n  if (typeof options === \"function\") {\n    callback = options;\n    options = null;\n  }\n\n  options = extend({ output: \"dom\", meta: false, sourceOnly: false }, options);\n  return compileFile(filename, options, callback);\n}\n\nexports.compileFile = compileFile;\nexports.compile = compile;\nexports.compileForBrowser = compileForBrowser;\nexports.compileFileForBrowser = compileFileForBrowser;\n\nexports.configure = configure;\n\nexports.taglibLookup = taglib.lookup;\nexports.taglibLoader = taglib.loader;\nexports.taglibFinder = taglib.finder;\nexports.buildTaglibLookup = taglib.lookup.buildLookup;\nexports.clearCaches = function clearCaches() {\n  compiler._clearDefaults();\n  taglib.clearCache();\n};\n\nexports.registerTaglib = function (filePath) {\n  ok(typeof filePath === \"string\", '\"filePath\" should be a string');\n  taglib.registerFromFile(filePath);\n  exports.clearCaches();\n};\n\nexports.isVDOMSupported = true;\n"],"file":"index.js"}